app-id: io.github.hermitdemschoenenleben.linien
runtime: org.kde.Platform
runtime-version: '5.14'
sdk: org.kde.Sdk
command: launcher.sh
finish-args:
  - --socket=x11
  - --share=ipc
  - --socket=wayland
  - --share=network
  - --device=dri

modules:
  - name: sip
    config-opts:
      - --no-dist-info
      - --no-stubs
      - --bindir=/app/bin
      - --destdir=/app/lib/python3.7/site-packages
      - --incdir=/app/include
      - --pyidir=/app/lib/python3.7/site-packages
      - --sipdir=/app/share/sip
      - --sip-module=PyQt5.sip
    sources:
      - type: archive
        url: https://www.riverbankcomputing.com/static/Downloads/sip/4.19.24/sip-4.19.24.tar.gz
        sha256: edcd3790bb01938191eef0f6117de0bf56d1136626c0ddb678f3a558d62e41e5
      - type: script
        commands:
          - processed=`sed -e 's|--prefix=/app||' <<< $@`
          - python3 configure.py $processed
        dest-filename: configure
    cleanup:
      - /bin
      - /include

  - name: pyqt5
    config-opts:
      - --assume-shared
      - --concatenate
      - --confirm-license
      - --no-designer-plugin
      - --no-dist-info
      - --no-docstrings
      - --no-qml-plugin
      - --no-qsci-api
      - --no-stubs
      - --no-tools
      - QMAKE_CFLAGS_RELEASE='-I/usr/include/python3.7m/'
      - QMAKE_CXXFLAGS_RELEASE='-I/usr/include/python3.7m/'
    build-options:
      arch:
        i386:
          config-opts:
            - --enable=QtCore
            - --enable=QtGui
            - --enable=QtNetwork
            - --enable=QtWidgets
            - --enable=QtOpenGL
        x86_64:
          config-opts:
            - --enable=QtCore
            - --enable=QtGui
            - --enable=QtNetwork
            - --enable=QtWidgets
            - --enable=QtOpenGL
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/1d/31/896dc3dfb6c81c70164019a6cbba6ab037e3af7653d9ca60ccc874ee4c27/PyQt5-5.15.1.tar.gz
        sha256: d9a76b850246d08da9863189ecb98f6c2aa9b4d97a3e85e29330a264aed0f9a1
      - type: script
        commands:
          - processed=`sed -e 's|prefix|sysroot|' <<< $@`
          - python3 configure.py $processed
        dest-filename: configure
    cleanup:
      - /share/sip

  - python3-cython.json
  - python3-wheel.json
  - python3-numpy.json
  #- lapack.json
  - python3-scipy.json
  - python3-stuff.json
  - python3-pyqtgraph.json
  - python3-paramiko.json
  - python3-linien.json

  - name: metadata
    buildsystem: simple
    sources:
      - type: file
        path: io.github.hermitdemschoenenleben.linien.desktop
      - type: file
        path: io.github.hermitdemschoenenleben.linien_64.png
      - type: file
        path: io.github.hermitdemschoenenleben.linien_128.png
      - type: file
        path: io.github.hermitdemschoenenleben.linien.metainfo.xml
    build-commands:
      - install -Dm644 io.github.hermitdemschoenenleben.linien.desktop /app/share/applications/io.github.hermitdemschoenenleben.linien.desktop
      - install -Dm644 io.github.hermitdemschoenenleben.linien_64.png /app/share/icons/hicolor/64x64/apps/io.github.hermitdemschoenenleben.linien.png
      - install -Dm644 io.github.hermitdemschoenenleben.linien_128.png /app/share/icons/hicolor/128x128/apps/io.github.hermitdemschoenenleben.linien.png
      - install -Dm644 io.github.hermitdemschoenenleben.linien.metainfo.xml /app/share/metainfo/io.github.hermitdemschoenenleben.linien.metainfo.xml

  - name: launcher
    buildsystem: simple
    build-commands:
      - install -D launcher.sh /app/bin/launcher.sh
    sources:
      - type: file
        path: launcher.sh